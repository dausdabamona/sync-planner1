<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <meta name="description" content="Sync Planner - Integrasi Perencanaan Harian Islami & Manajemen Tugas dengan Kanban Board">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Sync Planner">
    
    <title>Sync Planner + Kanban Board</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¯</text></svg>">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Theme Toggle -->
    <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
        <span class="theme-icon">ğŸŒ™</span>
    </button>

    <!-- Sync Status Indicator -->
    <div class="sync-indicator" id="sync-indicator">
        <span class="sync-icon">ğŸ”„</span>
        <span class="sync-text">Syncing...</span>
    </div>

    <!-- PWA Install Banner -->
    <div class="pwa-install-banner" id="pwa-install-banner">
        <div class="pwa-install-info">
            <span class="pwa-install-icon">ğŸ“±</span>
            <div class="pwa-install-text">
                <h4>Install Sync Planner</h4>
                <p>Akses offline & pengalaman lebih baik</p>
            </div>
        </div>
        <div class="pwa-install-actions">
            <button class="pwa-btn pwa-btn-dismiss" onclick="dismissPWABanner()">Nanti</button>
            <button class="pwa-btn pwa-btn-install" onclick="installPWA()">Install</button>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-brand">
                    <span class="header-icon">ğŸ¯</span>
                    <div>
                        <h1>Sync Planner</h1>
                        <p class="header-tagline">Produktivitas Berbasis Ibadah</p>
                    </div>
                </div>
                <div class="header-date" id="current-date"></div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="planner" onclick="switchTab('planner')">
                <span class="nav-icon">ğŸ“…</span>
                <span class="nav-text">Planner</span>
            </button>
            <button class="nav-tab" data-tab="pomodoro" onclick="switchTab('pomodoro')">
                <span class="nav-icon">ğŸ…</span>
                <span class="nav-text">Pomodoro</span>
            </button>
            <button class="nav-tab" data-tab="pairwise" onclick="switchTab('pairwise')">
                <span class="nav-icon">âš–ï¸</span>
                <span class="nav-text">Prioritas</span>
            </button>
            <button class="nav-tab" data-tab="kanban" onclick="switchTab('kanban')">
                <span class="nav-icon">ğŸ“‹</span>
                <span class="nav-text">Kanban</span>
            </button>
            <button class="nav-tab" data-tab="progress" onclick="switchTab('progress')">
                <span class="nav-icon">ğŸ“Š</span>
                <span class="nav-text">Progres</span>
            </button>
            <button class="nav-tab" data-tab="settings" onclick="switchTab('settings')">
                <span class="nav-icon">âš™ï¸</span>
                <span class="nav-text">Settings</span>
            </button>
        </nav>

        <!-- ==================== SYNC PLANNER TAB ==================== -->
        <div id="planner-tab" class="tab-content active">
            <div class="planner-grid">
                <!-- Morning Routine -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-tahajud">ğŸŒ™</div>
                        <h2 class="card-title">Rutinitas Tahajud & Subuh</h2>
                    </div>
                    
                    <div class="time-block">
                        <span class="time-label">03:30</span>
                        <div class="time-content">
                            <div class="time-title">Bangun Tahajud</div>
                            <div class="time-desc">Wudhu, sholat tahajud 2-8 rakaat</div>
                        </div>
                    </div>
                    
                    <div class="time-block">
                        <span class="time-label">04:00</span>
                        <div class="time-content">
                            <div class="time-title">Dzikir & Doa</div>
                            <div class="time-desc">Istighfar, tasbih, tawakkal</div>
                        </div>
                    </div>
                    
                    <div class="time-block">
                        <span class="time-label">04:30</span>
                        <div class="time-content">
                            <div class="time-title">Sholat Subuh</div>
                            <div class="time-desc">Berjamaah + dzikir pagi</div>
                        </div>
                    </div>
                    
                    <div class="time-block">
                        <span class="time-label">05:00</span>
                        <div class="time-content">
                            <div class="time-title">Refleksi Stoic</div>
                            <div class="time-desc">Premeditatio malorum, journaling</div>
                        </div>
                    </div>
                </div>

                <!-- Daily Checklist -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-morning">â˜€ï¸</div>
                        <h2 class="card-title">Checklist Harian</h2>
                    </div>
                    
                    <div id="checklist-container">
                        <div class="checklist-item" onclick="toggleCheck(this)" data-index="0">
                            <div class="checkbox">âœ“</div>
                            <span class="check-text">Tahajud minimal 2 rakaat</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)" data-index="1">
                            <div class="checkbox">âœ“</div>
                            <span class="check-text">Sholat Subuh berjamaah</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)" data-index="2">
                            <div class="checkbox">âœ“</div>
                            <span class="check-text">Dzikir pagi</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)" data-index="3">
                            <div class="checkbox">âœ“</div>
                            <span class="check-text">Olahraga 15-30 menit</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)" data-index="4">
                            <div class="checkbox">âœ“</div>
                            <span class="check-text">3 MIT (Most Important Tasks)</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)" data-index="5">
                            <div class="checkbox">âœ“</div>
                            <span class="check-text">Sholat Dzuhur</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)" data-index="6">
                            <div class="checkbox">âœ“</div>
                            <span class="check-text">Sholat Ashar</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)" data-index="7">
                            <div class="checkbox">âœ“</div>
                            <span class="check-text">Dzikir petang</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)" data-index="8">
                            <div class="checkbox">âœ“</div>
                            <span class="check-text">Sholat Maghrib</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)" data-index="9">
                            <div class="checkbox">âœ“</div>
                            <span class="check-text">Sholat Isya</span>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-label">
                        <span>Progres Hari Ini</span>
                        <span id="progress-text">0%</span>
                    </div>
                </div>

                <!-- Reflections -->
                <div class="card card-full">
                    <div class="card-header">
                        <div class="card-icon icon-reflection">ğŸ“</div>
                        <h2 class="card-title">Refleksi & Catatan</h2>
                    </div>
                    
                    <div class="reflection-grid">
                        <div class="reflection-item">
                            <label class="reflection-label">ğŸ¯ Apa yang berjalan baik hari ini?</label>
                            <textarea class="reflection-input" id="reflection-good" placeholder="Tuliskan pencapaian positif..." onchange="saveReflections()"></textarea>
                        </div>
                        <div class="reflection-item">
                            <label class="reflection-label">âš¡ Apa yang bisa diperbaiki?</label>
                            <textarea class="reflection-input" id="reflection-improve" placeholder="Area untuk perbaikan..." onchange="saveReflections()"></textarea>
                        </div>
                        <div class="reflection-item">
                            <label class="reflection-label">ğŸ™ Syukur (Gratitude)</label>
                            <textarea class="reflection-input" id="reflection-gratitude" placeholder="3 hal yang disyukuri hari ini..." onchange="saveReflections()"></textarea>
                        </div>
                        <div class="reflection-item">
                            <label class="reflection-label">ğŸ’­ Sedona Method: Lepaskan</label>
                            <textarea class="reflection-input" id="reflection-sedona" placeholder="Apa yang bisa dilepaskan?" onchange="saveReflections()"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== POMODORO TAB ==================== -->
        <div id="pomodoro-tab" class="tab-content">
            <div class="planner-grid">
                <!-- Timer Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-pomodoro">ğŸ…</div>
                        <h2 class="card-title">Pomodoro Timer</h2>
                    </div>
                    
                    <div class="timer-modes">
                        <button class="mode-btn active" data-mode="work" onclick="setTimerMode('work')">
                            ğŸ¯ Deep Work
                        </button>
                        <button class="mode-btn" data-mode="short-break" onclick="setTimerMode('short-break')">
                            â˜• Istirahat
                        </button>
                        <button class="mode-btn" data-mode="long-break" onclick="setTimerMode('long-break')">
                            ğŸ§˜ Panjang
                        </button>
                    </div>
                    
                    <div class="timer-container">
                        <svg class="timer-ring" viewBox="0 0 280 280">
                            <circle class="timer-ring-bg" cx="140" cy="140" r="130"></circle>
                            <circle class="timer-ring-progress work" id="timer-progress" cx="140" cy="140" r="130"></circle>
                        </svg>
                        <div class="timer-display">
                            <span class="timer-time" id="timer-display">25:00</span>
                            <span class="timer-mode" id="timer-mode-label">Deep Work</span>
                        </div>
                    </div>
                    
                    <div class="timer-controls">
                        <button class="timer-btn" id="btn-timer-start" onclick="startTimer()">â–¶ï¸ Mulai</button>
                        <button class="timer-btn" id="btn-timer-pause" onclick="pauseTimer()" style="display: none;">â¸ï¸ Pause</button>
                        <button class="timer-btn secondary" onclick="resetTimer()">ğŸ”„ Reset</button>
                        <button class="timer-btn secondary" onclick="skipTimer()">â­ï¸ Skip</button>
                    </div>
                    
                    <p class="session-info" id="session-info">Sesi 1 dari 4 ğŸ…</p>
                </div>

                <!-- Timer Stats -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-guide">ğŸ“Š</div>
                        <h2 class="card-title">Statistik Hari Ini</h2>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-value" id="stat-pomodoros">0</span>
                            <span class="stat-label">Pomodoro</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="stat-focus-time">0m</span>
                            <span class="stat-label">Fokus</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="stat-breaks">0</span>
                            <span class="stat-label">Istirahat</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="stat-streak">0</span>
                            <span class="stat-label">Streak</span>
                        </div>
                    </div>
                </div>

                <!-- Timer Settings -->
                <div class="card card-full">
                    <div class="card-header">
                        <div class="card-icon icon-settings">âš™ï¸</div>
                        <h2 class="card-title">Pengaturan Timer</h2>
                    </div>
                    
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label>ğŸ¯ Deep Work (menit)</label>
                            <input type="number" id="setting-work" value="25" min="1" max="120" onchange="updateTimerSettings()">
                        </div>
                        <div class="setting-item">
                            <label>â˜• Istirahat Pendek (menit)</label>
                            <input type="number" id="setting-short-break" value="5" min="1" max="30" onchange="updateTimerSettings()">
                        </div>
                        <div class="setting-item">
                            <label>ğŸ§˜ Istirahat Panjang (menit)</label>
                            <input type="number" id="setting-long-break" value="15" min="1" max="60" onchange="updateTimerSettings()">
                        </div>
                    </div>
                    
                    <div class="sound-settings">
                        <h4>ğŸ”Š Pengaturan Suara</h4>
                        <div class="sound-toggle">
                            <label>
                                <input type="checkbox" id="sound-enabled" checked onchange="updateSoundSettings()">
                                Aktifkan notifikasi suara
                            </label>
                        </div>
                        <div class="sound-volume">
                            <label>Volume</label>
                            <input type="range" id="sound-volume" min="0" max="100" value="50" onchange="updateSoundSettings()">
                        </div>
                        <button class="btn-secondary" onclick="testSound()">ğŸ”” Test Suara</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== PAIRWISE TAB ==================== -->
        <div id="pairwise-tab" class="tab-content">
            <div class="planner-grid">
                <!-- Input Options -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-input">ğŸ“</div>
                        <h2 class="card-title">Input Opsi</h2>
                    </div>
                    
                    <p class="card-desc">Masukkan opsi yang ingin dibandingkan (3-10 item)</p>
                    
                    <div class="input-group">
                        <input type="text" class="option-input" id="option-input" placeholder="Ketik opsi..." onkeypress="handleOptionKeypress(event)">
                        <button class="btn-primary" onclick="addOption()">â• Tambah</button>
                    </div>
                    
                    <div class="options-list" id="options-list">
                        <div class="empty-state">
                            <span>ğŸ“</span>
                            <p>Belum ada opsi. Tambahkan minimal 3 opsi.</p>
                        </div>
                    </div>
                    
                    <div class="options-actions">
                        <span class="options-count" id="options-count">0 opsi</span>
                        <button class="btn-secondary" onclick="clearAllOptions()">ğŸ—‘ï¸ Hapus Semua</button>
                        <button class="btn-primary" id="btn-start-comparison" onclick="startComparison()" disabled>â–¶ï¸ Mulai Perbandingan</button>
                    </div>
                </div>

                <!-- Comparison Card -->
                <div class="card" id="comparison-card" style="display: none;">
                    <div class="card-header">
                        <div class="card-icon icon-compare">âš–ï¸</div>
                        <h2 class="card-title">Pilih yang Lebih Penting</h2>
                    </div>
                    
                    <div class="comparison-progress">
                        <div class="comparison-progress-bar">
                            <div class="comparison-progress-fill" id="comparison-progress-fill"></div>
                        </div>
                        <span class="comparison-progress-text" id="comparison-progress-text">0 / 0</span>
                    </div>
                    
                    <div class="comparison-options">
                        <button class="comparison-btn" onclick="selectOption('a')">
                            <span class="comparison-text" id="option-text-a">Opsi A</span>
                        </button>
                        <div class="comparison-vs">VS</div>
                        <button class="comparison-btn" onclick="selectOption('b')">
                            <span class="comparison-text" id="option-text-b">Opsi B</span>
                        </button>
                    </div>
                </div>

                <!-- Results Card -->
                <div class="card" id="results-card" style="display: none;">
                    <div class="card-header">
                        <div class="card-icon icon-results">ğŸ†</div>
                        <h2 class="card-title">Hasil Prioritas</h2>
                    </div>
                    
                    <div class="results-list" id="results-list"></div>
                    
                    <div class="results-actions">
                        <button class="btn-secondary" onclick="resetComparison()">ğŸ”„ Ulang</button>
                        <button class="btn-primary" onclick="addResultsToKanban()">ğŸ“‹ Tambah ke Kanban</button>
                    </div>
                </div>

                <!-- Guide -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-guide">ğŸ’¡</div>
                        <h2 class="card-title">Cara Kerja</h2>
                    </div>
                    
                    <div class="guide-steps">
                        <div class="guide-step">
                            <span class="step-number">1</span>
                            <div class="step-content">
                                <strong>Tambahkan Opsi</strong>
                                <p>Minimal 3 opsi untuk dibandingkan</p>
                            </div>
                        </div>
                        <div class="guide-step">
                            <span class="step-number">2</span>
                            <div class="step-content">
                                <strong>Bandingkan</strong>
                                <p>Pilih mana yang lebih penting</p>
                            </div>
                        </div>
                        <div class="guide-step">
                            <span class="step-number">3</span>
                            <div class="step-content">
                                <strong>Lihat Hasil</strong>
                                <p>Dapatkan urutan prioritas</p>
                            </div>
                        </div>
                        <div class="guide-step">
                            <span class="step-number">4</span>
                            <div class="step-content">
                                <strong>Tambah ke Kanban</strong>
                                <p>Kirim hasil langsung ke Kanban Board</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== KANBAN TAB ==================== -->
        <div id="kanban-tab" class="tab-content">
            <!-- Quick Add -->
            <div class="kanban-quick-add">
                <input type="text" class="quick-task-input" id="quick-task-input" placeholder="Tambah tugas baru..." onkeypress="handleQuickTaskKeypress(event)">
                <select class="quick-task-priority" id="quick-task-priority">
                    <option value="high">ğŸ”´ Tinggi</option>
                    <option value="medium" selected>ğŸŸ¡ Sedang</option>
                    <option value="low">ğŸŸ¢ Rendah</option>
                </select>
                <button class="btn-primary" onclick="quickAddTask()">â• Tambah</button>
            </div>

            <!-- Kanban Stats -->
            <div class="kanban-stats">
                <div class="kanban-stat">
                    <span class="kanban-stat-value" id="stat-total">0</span>
                    <span class="kanban-stat-label">Total</span>
                </div>
                <div class="kanban-stat">
                    <span class="kanban-stat-value" id="stat-progress">0</span>
                    <span class="kanban-stat-label">In Progress</span>
                </div>
                <div class="kanban-stat">
                    <span class="kanban-stat-value" id="stat-done">0</span>
                    <span class="kanban-stat-label">Selesai</span>
                </div>
            </div>

            <!-- Kanban Board -->
            <div class="kanban-board">
                <!-- Backlog Column -->
                <div class="kanban-column">
                    <div class="column-header">
                        <h3>ğŸ“¥ Backlog</h3>
                        <span class="column-count" id="count-backlog">0</span>
                    </div>
                    <div class="column-content" id="column-backlog" ondragover="handleDragOver(event)" ondrop="handleDrop(event, 'backlog')"></div>
                </div>

                <!-- To Do Column -->
                <div class="kanban-column">
                    <div class="column-header">
                        <h3>ğŸ“‹ To Do</h3>
                        <span class="column-count" id="count-todo">0</span>
                    </div>
                    <div class="column-content" id="column-todo" ondragover="handleDragOver(event)" ondrop="handleDrop(event, 'todo')"></div>
                </div>

                <!-- In Progress Column -->
                <div class="kanban-column">
                    <div class="column-header">
                        <h3>ğŸ”„ In Progress</h3>
                        <span class="column-count" id="count-inprogress">0</span>
                    </div>
                    <div class="column-content" id="column-inprogress" ondragover="handleDragOver(event)" ondrop="handleDrop(event, 'inprogress')"></div>
                </div>

                <!-- Done Column -->
                <div class="kanban-column">
                    <div class="column-header">
                        <h3>âœ… Done</h3>
                        <span class="column-count" id="count-done">0</span>
                    </div>
                    <div class="column-content" id="column-done" ondragover="handleDragOver(event)" ondrop="handleDrop(event, 'done')"></div>
                </div>
            </div>
        </div>

        <!-- ==================== PROGRESS TAB ==================== -->
        <div id="progress-tab" class="tab-content">
            <div class="planner-grid">
                <!-- Period Selector -->
                <div class="card card-full">
                    <div class="card-header">
                        <div class="card-icon icon-guide">ğŸ“Š</div>
                        <h2 class="card-title">Rekap Progres</h2>
                    </div>
                    
                    <div class="period-selector">
                        <button class="period-btn active" data-period="week" onclick="showProgress('week')">ğŸ“… 1 Minggu</button>
                        <button class="period-btn" data-period="month" onclick="showProgress('month')">ğŸ“† 1 Bulan</button>
                        <button class="period-btn" data-period="quarter" onclick="showProgress('quarter')">ğŸ“Š 3 Bulan</button>
                        <button class="period-btn" data-period="year" onclick="showProgress('year')">ğŸ“ˆ 1 Tahun</button>
                    </div>
                </div>

                <!-- Summary Stats -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-pomodoro">ğŸ¯</div>
                        <h2 class="card-title">Ringkasan</h2>
                    </div>
                    
                    <div class="progress-summary" id="progress-summary">
                        <div class="summary-item">
                            <span class="summary-value" id="summary-tasks-completed">0</span>
                            <span class="summary-label">Tugas Selesai</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-value" id="summary-pomodoros">0</span>
                            <span class="summary-label">Total Pomodoro</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-value" id="summary-focus-hours">0h</span>
                            <span class="summary-label">Waktu Fokus</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-value" id="summary-checklist-avg">0%</span>
                            <span class="summary-label">Rata-rata Checklist</span>
                        </div>
                    </div>
                </div>

                <!-- Ibadah Stats -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-tahajud">ğŸ•Œ</div>
                        <h2 class="card-title">Statistik Ibadah</h2>
                    </div>
                    
                    <div class="ibadah-stats" id="ibadah-stats">
                        <div class="ibadah-item">
                            <span class="ibadah-icon">ğŸŒ™</span>
                            <div class="ibadah-info">
                                <span class="ibadah-name">Tahajud</span>
                                <div class="ibadah-bar">
                                    <div class="ibadah-fill" id="ibadah-tahajud" style="width: 0%"></div>
                                </div>
                            </div>
                            <span class="ibadah-percent" id="ibadah-tahajud-pct">0%</span>
                        </div>
                        <div class="ibadah-item">
                            <span class="ibadah-icon">â˜€ï¸</span>
                            <div class="ibadah-info">
                                <span class="ibadah-name">Subuh Berjamaah</span>
                                <div class="ibadah-bar">
                                    <div class="ibadah-fill" id="ibadah-subuh" style="width: 0%"></div>
                                </div>
                            </div>
                            <span class="ibadah-percent" id="ibadah-subuh-pct">0%</span>
                        </div>
                        <div class="ibadah-item">
                            <span class="ibadah-icon">ğŸ“¿</span>
                            <div class="ibadah-info">
                                <span class="ibadah-name">Dzikir Pagi</span>
                                <div class="ibadah-bar">
                                    <div class="ibadah-fill" id="ibadah-dzikir-pagi" style="width: 0%"></div>
                                </div>
                            </div>
                            <span class="ibadah-percent" id="ibadah-dzikir-pagi-pct">0%</span>
                        </div>
                        <div class="ibadah-item">
                            <span class="ibadah-icon">ğŸŒ…</span>
                            <div class="ibadah-info">
                                <span class="ibadah-name">Dzikir Petang</span>
                                <div class="ibadah-bar">
                                    <div class="ibadah-fill" id="ibadah-dzikir-petang" style="width: 0%"></div>
                                </div>
                            </div>
                            <span class="ibadah-percent" id="ibadah-dzikir-petang-pct">0%</span>
                        </div>
                        <div class="ibadah-item">
                            <span class="ibadah-icon">ğŸƒ</span>
                            <div class="ibadah-info">
                                <span class="ibadah-name">Olahraga</span>
                                <div class="ibadah-bar">
                                    <div class="ibadah-fill" id="ibadah-olahraga" style="width: 0%"></div>
                                </div>
                            </div>
                            <span class="ibadah-percent" id="ibadah-olahraga-pct">0%</span>
                        </div>
                    </div>
                </div>

                <!-- Daily Trend Chart -->
                <div class="card card-full">
                    <div class="card-header">
                        <div class="card-icon icon-morning">ğŸ“ˆ</div>
                        <h2 class="card-title">Trend Harian</h2>
                    </div>
                    
                    <div class="trend-chart" id="trend-chart">
                        <!-- Chart will be rendered here -->
                    </div>
                </div>

                <!-- History Log -->
                <div class="card card-full">
                    <div class="card-header">
                        <div class="card-icon icon-log">ğŸ“œ</div>
                        <h2 class="card-title">Riwayat Harian</h2>
                    </div>
                    
                    <div class="history-list" id="history-list">
                        <div class="empty-state">
                            <span>ğŸ“Š</span>
                            <p>Belum ada data. Mulai gunakan aplikasi untuk melihat riwayat.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== SETTINGS TAB ==================== -->
        <div id="settings-tab" class="tab-content">
            <div class="planner-grid">
                <!-- Google Sheets Setup -->
                <div class="card card-full">
                    <div class="card-header">
                        <div class="card-icon icon-gsheet">ğŸ“Š</div>
                        <h2 class="card-title">Google Sheets Sync</h2>
                    </div>
                    
                    <div class="setup-steps">
                        <div class="setup-step">
                            <span class="step-number">1</span>
                            <div class="step-content">
                                <strong>Buat Google Sheet baru</strong>
                                <p>Buka <a href="https://sheets.google.com" target="_blank">Google Sheets</a> dan buat spreadsheet baru</p>
                            </div>
                        </div>
                        <div class="setup-step">
                            <span class="step-number">2</span>
                            <div class="step-content">
                                <strong>Buka Apps Script</strong>
                                <p>Klik menu Extensions â†’ Apps Script</p>
                            </div>
                        </div>
                        <div class="setup-step">
                            <span class="step-number">3</span>
                            <div class="step-content">
                                <strong>Paste kode berikut</strong>
                                <button class="btn-secondary" onclick="toggleAppsScript()">ğŸ“ Lihat Kode</button>
                                <button class="btn-primary" onclick="copyAppsScript()">ğŸ“‹ Copy Kode</button>
                            </div>
                        </div>
                        <div class="setup-step">
                            <span class="step-number">4</span>
                            <div class="step-content">
                                <strong>Deploy sebagai Web App</strong>
                                <p>Deploy â†’ New deployment â†’ Web app â†’ Execute as: Me, Who: Anyone</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="apps-script-code" id="apps-script-code" style="display: none;">
                        <h4>Google Apps Script Code:</h4>
                        <p class="script-note">Copy seluruh kode di bawah ini ke Apps Script editor:</p>
                        <pre class="script-code" id="apps-script-content">
// ==================== SYNC PLANNER - GOOGLE APPS SCRIPT ====================
// Version 3.0 - With Auto Sync & Progress Tracking

function doGet(e) {
  return handleRequest(e, 'GET');
}

function doPost(e) {
  return handleRequest(e, 'POST');
}

function handleRequest(e, method) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  
  try {
    if (method === 'GET') {
      const type = e.parameter.type || 'tasks';
      
      switch(type) {
        case 'tasks':
          return getTasksData(ss);
        case 'daily':
          return getDailyData(ss, e.parameter.date);
        case 'progress':
          return getProgressData(ss, e.parameter.period || 'week');
        case 'sync':
          return getSyncData(ss);
        default:
          return createResponse({ success: true, message: 'API Ready' });
      }
    }
    
    if (method === 'POST') {
      const data = JSON.parse(e.postData.contents);
      
      switch(data.type) {
        case 'tasks':
          return saveTasksData(ss, data.tasks);
        case 'daily':
          return saveDailyData(ss, data);
        case 'pairwise':
          return savePairwiseData(ss, data);
        case 'progress':
          return saveProgressData(ss, data);
        case 'fullSync':
          return saveFullSync(ss, data);
        default:
          return createResponse({ success: false, error: 'Unknown type' });
      }
    }
  } catch (error) {
    return createResponse({ success: false, error: error.message });
  }
}

function createResponse(data) {
  return ContentService.createTextOutput(JSON.stringify(data))
    .setMimeType(ContentService.MimeType.JSON);
}

// ==================== TASKS ====================
function getTasksData(ss) {
  let sheet = ss.getSheetByName('Tasks');
  if (!sheet) {
    return createResponse({ success: true, data: [] });
  }
  
  const data = sheet.getDataRange().getValues();
  if (data.length <= 1) {
    return createResponse({ success: true, data: [] });
  }
  
  const tasks = [];
  for (let i = 1; i < data.length; i++) {
    if (data[i][0]) {
      tasks.push({
        id: data[i][0],
        title: data[i][1],
        column: data[i][2],
        priority: data[i][3],
        notes: data[i][4] || '',
        link: data[i][5] || '',
        created: data[i][6],
        completed: data[i][7] || ''
      });
    }
  }
  
  return createResponse({ success: true, data: tasks });
}

function saveTasksData(ss, tasks) {
  let sheet = ss.getSheetByName('Tasks');
  if (!sheet) {
    sheet = ss.insertSheet('Tasks');
    sheet.appendRow(['ID', 'Title', 'Column', 'Priority', 'Notes', 'Link', 'Created', 'Completed']);
    sheet.getRange(1, 1, 1, 8).setFontWeight('bold');
  }
  
  // Clear existing data (except header)
  const lastRow = sheet.getLastRow();
  if (lastRow > 1) {
    sheet.deleteRows(2, lastRow - 1);
  }
  
  // Add new data
  tasks.forEach(task => {
    sheet.appendRow([
      task.id,
      task.title,
      task.column,
      task.priority,
      task.notes || '',
      task.link || '',
      task.created,
      task.completed || ''
    ]);
  });
  
  return createResponse({ success: true, message: 'Tasks saved', count: tasks.length });
}

// ==================== DAILY DATA ====================
function getDailyData(ss, date) {
  let sheet = ss.getSheetByName('Daily');
  if (!sheet) {
    return createResponse({ success: true, data: null });
  }
  
  const data = sheet.getDataRange().getValues();
  for (let i = 1; i < data.length; i++) {
    if (data[i][0] === date) {
      return createResponse({
        success: true,
        data: {
          date: data[i][0],
          checklist: JSON.parse(data[i][1] || '[]'),
          reflections: JSON.parse(data[i][2] || '{}'),
          pomodoros: data[i][3] || 0,
          focusTime: data[i][4] || 0
        }
      });
    }
  }
  
  return createResponse({ success: true, data: null });
}

function saveDailyData(ss, data) {
  let sheet = ss.getSheetByName('Daily');
  if (!sheet) {
    sheet = ss.insertSheet('Daily');
    sheet.appendRow(['Date', 'Checklist', 'Reflections', 'Pomodoros', 'FocusTime', 'Timestamp']);
    sheet.getRange(1, 1, 1, 6).setFontWeight('bold');
  }
  
  // Check if entry for today exists
  const allData = sheet.getDataRange().getValues();
  let rowIndex = -1;
  for (let i = 1; i < allData.length; i++) {
    if (allData[i][0] === data.date) {
      rowIndex = i + 1;
      break;
    }
  }
  
  if (rowIndex > 0) {
    // Update existing row
    sheet.getRange(rowIndex, 2).setValue(JSON.stringify(data.checklist));
    sheet.getRange(rowIndex, 3).setValue(JSON.stringify(data.reflections));
    sheet.getRange(rowIndex, 4).setValue(data.pomodoros || 0);
    sheet.getRange(rowIndex, 5).setValue(data.focusTime || 0);
    sheet.getRange(rowIndex, 6).setValue(new Date().toISOString());
  } else {
    // Add new row
    sheet.appendRow([
      data.date,
      JSON.stringify(data.checklist),
      JSON.stringify(data.reflections),
      data.pomodoros || 0,
      data.focusTime || 0,
      new Date().toISOString()
    ]);
  }
  
  return createResponse({ success: true, message: 'Daily data saved' });
}

// ==================== PROGRESS DATA ====================
function getProgressData(ss, period) {
  let sheet = ss.getSheetByName('Daily');
  if (!sheet) {
    return createResponse({ success: true, data: { days: [], summary: {} } });
  }
  
  const now = new Date();
  let startDate = new Date();
  
  switch(period) {
    case 'week':
      startDate.setDate(now.getDate() - 7);
      break;
    case 'month':
      startDate.setMonth(now.getMonth() - 1);
      break;
    case 'quarter':
      startDate.setMonth(now.getMonth() - 3);
      break;
    case 'year':
      startDate.setFullYear(now.getFullYear() - 1);
      break;
  }
  
  const data = sheet.getDataRange().getValues();
  const days = [];
  let totalPomodoros = 0;
  let totalFocus = 0;
  let totalChecklist = 0;
  let checklistDays = 0;
  
  for (let i = 1; i < data.length; i++) {
    const rowDate = new Date(data[i][0].split('/').reverse().join('-'));
    if (rowDate >= startDate) {
      const checklist = JSON.parse(data[i][1] || '[]');
      const checked = checklist.filter(c => c).length;
      const total = checklist.length || 10;
      
      days.push({
        date: data[i][0],
        checklistPercent: Math.round((checked / total) * 100),
        pomodoros: data[i][3] || 0,
        focusTime: data[i][4] || 0
      });
      
      totalPomodoros += data[i][3] || 0;
      totalFocus += data[i][4] || 0;
      totalChecklist += (checked / total) * 100;
      checklistDays++;
    }
  }
  
  // Get completed tasks
  let tasksSheet = ss.getSheetByName('Tasks');
  let completedTasks = 0;
  if (tasksSheet) {
    const tasksData = tasksSheet.getDataRange().getValues();
    for (let i = 1; i < tasksData.length; i++) {
      if (tasksData[i][2] === 'done') {
        const completedDate = tasksData[i][7] ? new Date(tasksData[i][7]) : null;
        if (completedDate && completedDate >= startDate) {
          completedTasks++;
        }
      }
    }
  }
  
  return createResponse({
    success: true,
    data: {
      days: days,
      summary: {
        tasksCompleted: completedTasks,
        totalPomodoros: totalPomodoros,
        focusHours: Math.round(totalFocus / 60 * 10) / 10,
        avgChecklist: checklistDays > 0 ? Math.round(totalChecklist / checklistDays) : 0
      }
    }
  });
}

// ==================== PAIRWISE ====================
function savePairwiseData(ss, data) {
  let sheet = ss.getSheetByName('Pairwise');
  if (!sheet) {
    sheet = ss.insertSheet('Pairwise');
    sheet.appendRow(['Date', 'Comparisons', 'Results', 'Timestamp']);
    sheet.getRange(1, 1, 1, 4).setFontWeight('bold');
  }
  
  sheet.appendRow([
    new Date().toLocaleDateString('id-ID'),
    data.totalComparisons,
    JSON.stringify(data.results),
    new Date().toISOString()
  ]);
  
  return createResponse({ success: true, message: 'Pairwise saved' });
}

// ==================== FULL SYNC ====================
function getSyncData(ss) {
  const tasksResult = JSON.parse(getTasksData(ss).getContent());
  const today = new Date().toLocaleDateString('id-ID');
  const dailyResult = JSON.parse(getDailyData(ss, today).getContent());
  
  return createResponse({
    success: true,
    data: {
      tasks: tasksResult.data || [],
      daily: dailyResult.data || null,
      lastSync: new Date().toISOString()
    }
  });
}

function saveFullSync(ss, data) {
  // Save tasks
  if (data.tasks) {
    saveTasksData(ss, data.tasks);
  }
  
  // Save daily
  if (data.daily) {
    saveDailyData(ss, data.daily);
  }
  
  return createResponse({ 
    success: true, 
    message: 'Full sync complete',
    timestamp: new Date().toISOString()
  });
}
                        </pre>
                    </div>
                </div>

                <!-- Connection Settings -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-connection">ğŸ”—</div>
                        <h2 class="card-title">Koneksi</h2>
                    </div>
                    
                    <div class="connection-status" id="connection-status">
                        <span class="status-icon">âšª</span>
                        <span class="status-text">Belum terhubung</span>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Web App URL</label>
                        <input type="url" class="form-input" id="gsheet-url" placeholder="https://script.google.com/macros/s/...">
                        <p class="form-hint">Paste URL dari deployment Apps Script</p>
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn-secondary" onclick="testConnection()">ğŸ§ª Test Koneksi</button>
                        <button class="btn-primary" onclick="saveGSheetSettings()">ğŸ’¾ Simpan</button>
                    </div>
                </div>

                <!-- Auto Sync Settings -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-sync">ğŸ”„</div>
                        <h2 class="card-title">Auto Sync</h2>
                    </div>
                    
                    <div class="auto-sync-settings">
                        <div class="setting-toggle">
                            <label>
                                <input type="checkbox" id="auto-sync-enabled" onchange="updateAutoSyncSettings()">
                                Aktifkan Auto Sync
                            </label>
                            <p class="setting-desc">Data akan disinkronkan secara otomatis</p>
                        </div>
                        
                        <div class="setting-item">
                            <label>Interval Sync (menit)</label>
                            <select id="sync-interval" onchange="updateAutoSyncSettings()">
                                <option value="1">1 menit</option>
                                <option value="5" selected>5 menit</option>
                                <option value="10">10 menit</option>
                                <option value="15">15 menit</option>
                                <option value="30">30 menit</option>
                            </select>
                        </div>
                        
                        <div class="last-sync-info">
                            <span>Sync terakhir:</span>
                            <span id="last-sync-time">Belum pernah</span>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn-primary" onclick="manualSync()">ğŸ”„ Sync Sekarang</button>
                    </div>
                </div>

                <!-- Manual Sync Actions -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-data">ğŸ“¤</div>
                        <h2 class="card-title">Sinkronisasi Manual</h2>
                    </div>
                    
                    <div class="sync-actions">
                        <div class="sync-item">
                            <div class="sync-info">
                                <h4>ğŸ“‹ Kanban Tasks</h4>
                                <p>Sync semua tugas ke/dari Google Sheets</p>
                            </div>
                            <div class="sync-buttons">
                                <button class="btn-sync" onclick="syncTasksToSheet()">â¬†ï¸ Upload</button>
                                <button class="btn-sync" onclick="loadTasksFromSheet()">â¬‡ï¸ Download</button>
                            </div>
                        </div>
                        
                        <div class="sync-item">
                            <div class="sync-info">
                                <h4>ğŸ“… Data Harian</h4>
                                <p>Checklist & refleksi hari ini</p>
                            </div>
                            <div class="sync-buttons">
                                <button class="btn-sync" onclick="syncDailyToSheet()">â¬†ï¸ Upload</button>
                                <button class="btn-sync" onclick="loadDailyFromSheet()">â¬‡ï¸ Download</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Activity Log -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-log">ğŸ“œ</div>
                        <h2 class="card-title">Log Aktivitas</h2>
                    </div>
                    
                    <div class="log-container" id="log-entries">
                        <div class="log-empty">Belum ada aktivitas sync</div>
                    </div>
                </div>

                <!-- Data Management -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-data">ğŸ’¾</div>
                        <h2 class="card-title">Manajemen Data</h2>
                    </div>
                    
                    <div class="data-actions">
                        <button class="btn-secondary" onclick="exportAllData()">ğŸ“¤ Export Data (JSON)</button>
                        <button class="btn-secondary" onclick="document.getElementById('import-file').click()">ğŸ“¥ Import Data</button>
                        <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importAllData(event)">
                        <button class="btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ Hapus Semua Data</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Edit Modal -->
    <div class="modal-overlay" id="task-modal">
        <div class="modal">
            <h2>âœï¸ Edit Tugas</h2>
            <input type="hidden" id="edit-task-id">
            <input type="text" class="modal-input" id="edit-task-title" placeholder="Judul tugas">
            <select class="modal-select" id="edit-task-priority">
                <option value="high">ğŸ”´ Prioritas Tinggi</option>
                <option value="medium">ğŸŸ¡ Prioritas Sedang</option>
                <option value="low">ğŸŸ¢ Prioritas Rendah</option>
            </select>
            <select class="modal-select" id="edit-task-column">
                <option value="backlog">ğŸ“¥ Backlog</option>
                <option value="todo">ğŸ“‹ To Do</option>
                <option value="inprogress">ğŸ”„ In Progress</option>
                <option value="done">âœ… Done</option>
            </select>
            <textarea class="modal-input modal-textarea" id="edit-task-notes" placeholder="Catatan..."></textarea>
            <input type="url" class="modal-input" id="edit-task-link" placeholder="Link (opsional)">
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-delete" onclick="deleteTask()">ğŸ—‘ï¸ Hapus</button>
                <button class="modal-btn modal-btn-cancel" onclick="closeTaskModal()">Batal</button>
                <button class="modal-btn modal-btn-save" onclick="saveTaskEdit()">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Pairwise to Kanban Modal -->
    <div class="modal-overlay" id="pairwise-kanban-modal">
        <div class="modal">
            <h2>ğŸ“‹ Tambah ke Kanban</h2>
            <p class="modal-desc">Pilih prioritas yang akan ditambahkan ke Kanban Board:</p>
            <div class="pairwise-kanban-list" id="pairwise-kanban-list"></div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="closePairwiseKanbanModal()">Batal</button>
                <button class="modal-btn modal-btn-save" onclick="confirmAddToKanban()">Tambahkan</button>
            </div>
        </div>
    </div>

    <!-- Audio for notifications -->
    <audio id="notification-sound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2teleQwHYre51JdyCgNoo8OzkHQJBVmPuLKQfBUIVIS0sJeEFgxOgLCzlYYOAl58qrGxnpQhE1qBprOxnJMdGVp8n6+2ppwlFlqFpqawmJIXFlV5m6W0sZstJk19oaqwpJMRE0x3laGltaA2MU13mamolokMCUp9lZmcoKRKO010lqWdjoYLBEl9kpOWmJlWRlN0laGalY4ODU5+kIySkYxXR1Vzj5eYk5IWFk1+j4qHg3paSlRwjJGRj5IaG01+jYiBdnFhSlVtioqJho0cHEt+i4N1a2VjT1triYWAe4MZHUR8iIF2bWhlWFtnhH94b24TFT17h392cXBrXFxmdXtwaGcTEDl4hXp2dHNtYmJocnJqYWIODTd0gXd0c3VubGtsbm5mXl4MCTR0fXNwcHFwcXFubGRdWQkINXF6cGxqam1vcW9rYl1YCgczcXZsaGZlanBwbmhgW1gJBzJucWllYF5ka2xpZFxYVggHMGxsZ2JdW2BnaGViXVhVCAcvamllXlhYXWRkYV1ZVVMICC5oZmFaVVRaYV9dWlZSUAgILWZiXldTUlhcW1lWUk9NCAgqY15aVFBPVFhXVVJOTEoICClhW1ZRT01RVFNRTktJRwgJKF9YVFBMS09SUEZNR0RHBwknXFVRTkpITU9NSkVDQEQHCSdbUk5LR0VMTUpHQz4+QQcKJVlPTEhFQ0lKR0RBPT06BwsRWE1JRUJASEZDPzw4NwYAB1BJRUI+PENCPzs3MzQHCCFMRT49OjlAPDs2MS0sBgkgSUI7OTY0Ojg1MSwpKAYKH0U+ODYyMTY0Mi0pJiQGDRtAOTQxLi0yMC0pJSIfBw0YOzYwLSsqLiwnJCEeHAcOFDYxLCkoJysnIyAfHRsIEBIxLCgnJSQoJSEeHBkYCBAPLCglIyIhJSEfGxkXFgkRDSklISAdHCEeGxgVExMJEwwlIR4bGRkdGhcUEhAPChYPHx0aFxYWGRYTEA4NDAsLFBcZFhQTFBYTEA4LCggJCxQVEw8ODRANGQ4LCQcGBgsMEA4MCgkNDAwLCQcFBAMGBgkLCgoKCgsLCgkIBgUEBAQFBwkJCQkJCQkJCAcGBQQEBAUGBwgICAcIBwcHBwYGBQUFBQUFBgYGBgYGBgYGBgYGBgYGBQUFBQUFBQUFBQU=" type="audio/wav">
    </audio>

    <!-- Scripts -->
    <script src="app.js"></script>
</body>
</html>
